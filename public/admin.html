<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼èˆªç®¡ç†åå°</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="admin-container">
        <header style="text-align: center; margin-bottom: 30px;">
            <h1 style="color: #333;"><i class="fas fa-cog"></i> å¯¼èˆªç®¡ç†åå°</h1>
            <p style="color: #666;">æ·»åŠ ã€ç¼–è¾‘æˆ–åˆ é™¤å¯¼èˆªé¡¹</p>
        </header>
        
        <div id="statusMessage" class="status-message"></div>
        
        <!-- æ·»åŠ /ç¼–è¾‘è¡¨å• -->
        <div class="form-section">
            <h2 style="margin-bottom: 20px; color: #333;">
                <i class="fas fa-plus-circle"></i> 
                <span id="formTitle">æ·»åŠ æ–°å¯¼èˆªé¡¹</span>
            </h2>
            
            <form id="navForm">
                <input type="hidden" id="itemId" value="">
                
                <div class="form-group">
                    <label for="name">ç½‘ç«™åç§°</label>
                    <input type="text" id="name" required placeholder="ä¾‹å¦‚ï¼šGoogle">
                </div>
                
                <div class="form-group">
                    <label for="url">ç½‘ç«™åœ°å€</label>
                    <input type="url" id="url" required placeholder="https://example.com">
                </div>
                
                <div class="form-group">
                    <label for="icon">å›¾æ ‡ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" id="icon" placeholder="ä¾‹å¦‚ï¼šğŸ” æˆ– ğŸ™">
                    <small style="color: #666;">å¯ä»¥ä½¿ç”¨è¡¨æƒ…ç¬¦å·æˆ–å›¾æ ‡åç§°</small>
                </div>
                
                <div class="form-group">
                    <label for="category">åˆ†ç±»</label>
                    <input type="text" id="category" required placeholder="ä¾‹å¦‚ï¼šæœç´¢ã€å¼€å‘ã€å­¦ä¹ ">
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> 
                        <span id="submitBtnText">æ·»åŠ å¯¼èˆªé¡¹</span>
                    </button>
                    <button type="button" class="btn" onclick="resetForm()" style="background: #6c757d;">
                        <i class="fas fa-redo"></i> é‡ç½®
                    </button>
                </div>
            </form>
        </div>
        
        <!-- ç°æœ‰é¡¹ç›®åˆ—è¡¨ -->
        <div class="item-list">
            <h2 style="margin: 30px 0 20px; color: #333;">
                <i class="fas fa-list"></i> ç°æœ‰å¯¼èˆªé¡¹
            </h2>
            
            <div id="itemList">
                <!-- é¡¹ç›®åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee;">
            <a href="index.html" class="btn" style="background: #333;">
                <i class="fas fa-home"></i> è¿”å›å¯¼èˆªé¦–é¡µ
            </a>
        </div>
    </div>
    
    <script>
        let currentEditId = null;
        
        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showMessage(message, type = 'success') {
            const messageEl = document.getElementById('statusMessage');
            messageEl.textContent = message;
            messageEl.className = `status-message ${type}`;
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 3000);
        }
        
        // åŠ è½½å¯¼èˆªé¡¹åˆ—è¡¨
        async function loadItems() {
            try {
                const response = await fetch('/api/navigation');
                const data = await response.json();
                renderItemList(data);
            } catch (error) {
                showMessage('åŠ è½½æ•°æ®å¤±è´¥', 'error');
            }
        }
        
        // æ¸²æŸ“é¡¹ç›®åˆ—è¡¨
        function renderItemList(items) {
            const container = document.getElementById('itemList');
            
            if (items.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— å¯¼èˆªé¡¹ï¼Œè¯·æ·»åŠ ã€‚</p>';
                return;
            }
            
            container.innerHTML = '';
            
            items.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'item-card';
                itemEl.innerHTML = `
                    <div class="item-info">
                        <h3>${item.icon || 'ğŸ”—'} ${item.name}</h3>
                        <p><i class="fas fa-link"></i> ${item.url}</p>
                        <p><i class="fas fa-tag"></i> ${item.category}</p>
                    </div>
                    <div class="item-actions">
                        <button class="btn" onclick="editItem(${item.id})">
                            <i class="fas fa-edit"></i> ç¼–è¾‘
                        </button>
                        <button class="btn btn-delete" onclick="deleteItem(${item.id})">
                            <i class="fas fa-trash"></i> åˆ é™¤
                        </button>
                    </div>
                `;
                container.appendChild(itemEl);
            });
        }
        
        // ç¼–è¾‘é¡¹ç›®
        async function editItem(id) {
            try {
                const response = await fetch('/api/navigation');
                const items = await response.json();
                const item = items.find(i => i.id === id);
                
                if (item) {
                    document.getElementById('itemId').value = item.id;
                    document.getElementById('name').value = item.name;
                    document.getElementById('url').value = item.url;
                    document.getElementById('icon').value = item.icon || '';
                    document.getElementById('category').value = item.category;
                    
                    document.getElementById('formTitle').textContent = 'ç¼–è¾‘å¯¼èˆªé¡¹';
                    document.getElementById('submitBtnText').textContent = 'ä¿å­˜ä¿®æ”¹';
                    
                    currentEditId = id;
                    document.getElementById('name').focus();
                }
            } catch (error) {
                showMessage('è·å–é¡¹ç›®æ•°æ®å¤±è´¥', 'error');
            }
        }
        
        // åˆ é™¤é¡¹ç›®
        async function deleteItem(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯¼èˆªé¡¹å—ï¼Ÿ')) return;
            
            try {
                const response = await fetch(`/api/navigation/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showMessage('åˆ é™¤æˆåŠŸ');
                    loadItems();
                } else {
                    showMessage('åˆ é™¤å¤±è´¥', 'error');
                }
            } catch (error) {
                showMessage('åˆ é™¤å¤±è´¥', 'error');
            }
        }
        
        // é‡ç½®è¡¨å•
        function resetForm() {
            document.getElementById('navForm').reset();
            document.getElementById('itemId').value = '';
            document.getElementById('formTitle').textContent = 'æ·»åŠ æ–°å¯¼èˆªé¡¹';
            document.getElementById('submitBtnText').textContent = 'æ·»åŠ å¯¼èˆªé¡¹';
            currentEditId = null;
        }
        
        // è¡¨å•æäº¤å¤„ç†
        document.getElementById('navForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const itemData = {
                name: document.getElementById('name').value,
                url: document.getElementById('url').value,
                icon: document.getElementById('icon').value,
                category: document.getElementById('category').value
            };
            
            try {
                let response;
                
                if (currentEditId) {
                    // æ›´æ–°ç°æœ‰é¡¹
                    response = await fetch(`/api/navigation/${currentEditId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(itemData)
                    });
                } else {
                    // æ·»åŠ æ–°é¡¹
                    response = await fetch('/api/navigation', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(itemData)
                    });
                }
                
                if (response.ok) {
                    showMessage(currentEditId ? 'æ›´æ–°æˆåŠŸ' : 'æ·»åŠ æˆåŠŸ');
                    resetForm();
                    loadItems();
                } else {
                    showMessage('æ“ä½œå¤±è´¥', 'error');
                }
            } catch (error) {
                showMessage('æ“ä½œå¤±è´¥', 'error');
            }
        });
        
        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        document.addEventListener('DOMContentLoaded', loadItems);
    </script>
</body>
</html>