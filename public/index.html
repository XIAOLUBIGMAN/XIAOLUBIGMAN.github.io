<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å¯¼èˆªé¡µ</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-compass"></i> æˆ‘çš„å¯¼èˆªç«™</h1>
            <p>å¿«é€Ÿè®¿é—®å¸¸ç”¨ç½‘ç«™</p>
        </header>
        
        <div class="category-filter" id="categoryFilter">
            <button class="filter-btn active" data-category="all">å…¨éƒ¨</button>
            <!-- åˆ†ç±»æŒ‰é’®å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div class="nav-grid" id="navGrid">
            <!-- å¯¼èˆªé¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <footer style="text-align: center; color: white; margin-top: 50px; opacity: 0.8;">
            <p>å…± <span id="itemCount">0</span> ä¸ªå¯¼èˆªé¡¹ | 
               <a href="admin.html" style="color: white; text-decoration: underline;">ç®¡ç†åå°</a>
            </p>
        </footer>
    </div>
    
    <script>
        // ä»åç«¯è·å–æ•°æ®
        async function loadNavigation() {
            try {
                const response = await fetch('/api/navigation');
                const data = await response.json();
                renderNavigation(data);
                updateCategoryFilter(data);
            } catch (error) {
                console.error('åŠ è½½å¯¼èˆªæ•°æ®å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°åˆ†ç±»ç­›é€‰å™¨
        function updateCategoryFilter(data) {
            const categories = [...new Set(data.map(item => item.category))];
            const filterContainer = document.getElementById('categoryFilter');
            
            // æ¸…ç©ºç°æœ‰æŒ‰é’®ï¼ˆä¿ç•™"å…¨éƒ¨"æŒ‰é’®ï¼‰
            const allBtn = filterContainer.querySelector('[data-category="all"]');
            filterContainer.innerHTML = '';
            filterContainer.appendChild(allBtn);
            
            // æ·»åŠ åˆ†ç±»æŒ‰é’®
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.dataset.category = category;
                button.textContent = category;
                button.onclick = () => filterByCategory(category);
                filterContainer.appendChild(button);
            });
        }
        
        // ç­›é€‰åˆ†ç±»
        function filterByCategory(category) {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ç­›é€‰æ˜¾ç¤º
            const allItems = document.querySelectorAll('.nav-item');
            allItems.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
            
            // æ›´æ–°è®¡æ•°
            const visibleCount = Array.from(allItems).filter(item => 
                item.style.display !== 'none'
            ).length;
            document.getElementById('itemCount').textContent = visibleCount;
        }
        
        // æ¸²æŸ“å¯¼èˆªé¡¹
        function renderNavigation(data) {
            const container = document.getElementById('navGrid');
            container.innerHTML = '';
            
            data.forEach(item => {
                const navItem = document.createElement('a');
                navItem.href = item.url;
                navItem.target = '_blank';
                navItem.className = 'nav-item';
                navItem.dataset.category = item.category;
                
                navItem.innerHTML = `
                    <div class="icon">${item.icon || 'ğŸ”—'}</div>
                    <div class="name">${item.name}</div>
                    <div class="category">${item.category}</div>
                `;
                
                container.appendChild(navItem);
            });
            
            // æ›´æ–°æ€»æ•°
            document.getElementById('itemCount').textContent = data.length;
        }
        
        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        document.addEventListener('DOMContentLoaded', loadNavigation);
        
        // ç‚¹å‡»"å…¨éƒ¨"æŒ‰é’®
        document.querySelector('[data-category="all"]').onclick = () => {
            filterByCategory('all');
        };
    </script>
</body>
</html>